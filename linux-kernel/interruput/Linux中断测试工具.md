## 中断延迟
最大关中断时间：

系统中断优先级的设定和关中断操作，都会影响系统响应中断的时间。

## 中断延迟测量方法

根据中断延迟定义，测量中断延迟时需要在中断触发前和中断回调函数被唤醒时这两个时间点进行打点计时，二者的差值便是中断延迟。

由于外部中断的触发时间不容易被系统测量到，因此系统中通常采用模拟的方式触发中断，这里提供两种常用方式：

1. 利用高精度定时器模拟外部中断源，在定时器回调函数中分别获取系统当前时间now和定时器到期的预期时间expected的插值delta来衡量中断延迟：delta=now-expected.
定时器的expected周期到期后，会触发中断唤醒定时器回调函数，在理想情况下，定时器回调函数中获取到的当前时间，应该与定时器的 expected 值相同，但实际上，由于中断延迟的存在，定时器expected到期触发中断后，到定时器中断回调函数被唤醒之间需要一定的时间，因此可以将该段时间作为定时器中断的中断延迟。

2. 通过软件修改 GIC 寄存器的方式模拟中断触发，分别记录软件触发中断之前和对应中断回调函数被唤醒这两个时间点的时间，二者的差值作为中断延迟。
外部中断产生后会被GIC控制器捕获，由GIC Distributor 分发后再传递给CPU interfaces 处理，最后会触发系统设置的中断回调函数。
以GICV2为例，软件通过设置GIC寄存器GICD_ISPENDRn，可以通过软件标记对应中断号被置位（当真实的外部中断产生时，会首先抵达GIC Distributor，对应中断号被标记为 pending状态，等待CPU处理参考：gic-v2 和 fuchsia 中 arm 中断相关原理）。