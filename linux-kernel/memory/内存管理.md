# 地址空间和MMU

内存管理单元MMU是硬件提供的最底层的内存管理机制，是CPU生成逻辑地址并交给分段单元。分段单元是每个逻辑地址生成一个线性地址。然后线性地址交给分页单元，以生成内存的物理地址。因此也就是分段和分页单元组成了内存管理单元MMU.

为什么有虚拟地址？



# 内存分段

内存分段是操作管理虚拟地址和物理地址之间的关系的方式之一，还有一种是内存分页。

程序是由若干个逻辑分段组成的，如可由代码分段、数据分段、栈段、堆段组成。


# part 15：虚拟地址和MMU工作原理

## 虚拟地址的基本概念

MMU可以权限化管理。

MMU工作原理

虚拟页号、物理页号
页表
使能MMU
TLB\ Table walk Unit


# 建立地址映射
内核需要物理内存时，很多情况是整页分配的，这在上面的mem_map中摘一个page下来就好了。比如前面说到的内核捕获缺页异常，然后需要分配一个page以建立映射。

内核代码所访问的地址都是虚拟地址，因为CPU指令接收的就是虚拟地址。但是，建立地址映射时，内核在页表里面的内容却是物理地址，因为地址映射的目标就是要得到物理地址。mem_map中的page就是根据物理内存来建立的，每一个page对应一个物理页。

虚拟地址的映射是靠这里page结构来完成的，是它们给出了最终的物理地址。然而，page结构显然是通过虚拟地址来管理的。在内核初始化时，内核的地址空间就已经把地址映射写死了。page结构显然存在于内核空间，所以他的地址映射已经固定映射。
